# .github/workflows/flutter_web_build.yml

name: Flutter Web Build and Deploy

on:
  push:
    branches:
      - main  # デプロイしたいブランチを指定

permissions:
  contents: write  # `write` 権限を付与する

jobs:
  build:
    name: Build Flutter Web and Deploy to Main Branch
    runs-on: ubuntu-latest

    steps:
      # リポジトリのクローンを作成
      - name: Checkout repository
        uses: actions/checkout@v2
        with:
            persist-credentials: true  # `checkout` で認証情報を保持する

      # Flutter のセットアップ（必要なバージョンを指定）
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.24.3'  # Flutter のバージョンを指定

      # Flutter の依存関係を取得
      - name: Install dependencies
        run: flutter pub get
        working-directory: flutter_app  # 必要に応じてプロジェクトのディレクトリを指定

      # Flutter Web ビルドの実行
      - name: Build Flutter Web
        run: flutter build web
        working-directory: flutter_app  # 必要に応じてプロジェクトのディレクトリを指定

      # ビルドされたファイルをルートにコピー
      - name: Copy Built Files to Root Directory
        run: cp -r flutter_app/build/web/* .

      # `main` ブランチに変更をコミット & プッシュ
      - name: Commit and Push changes
        run: |
          git config --local user.name "github-actions[bot]"
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git add -A
          git commit -m "Deploy Web build to root directory"
          git push origin main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # 環境変数に GITHUB_TOKEN を設定
